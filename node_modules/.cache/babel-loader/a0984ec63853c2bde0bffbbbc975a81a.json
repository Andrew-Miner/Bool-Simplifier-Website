{"ast":null,"code":"import _createForOfIteratorHelper from\"C:/Users/Andrew/Documents/JavaScript Projects/bool-simp/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";/* eslint-disable no-eval */import StructFactory from\"../StructFactory\";import{Terminal,NonTerminal}from\"./Symbol\";export var EarleyItem=StructFactory(\"rule next start\");export var Grammar=StructFactory(\"startRule rules\");export var Rule=StructFactory(\"name definition\");export var testG2=new Grammar(\"A\",[new Rule(\"A\",[new NonTerminal(\"A\"),new Terminal(\"a\")]),new Rule(\"A\",[])]);export var testG=new Grammar(\"Sum\",[new Rule(\"Sum\",[new NonTerminal(\"Sum\"),new Terminal([\"+\",\"-\"]),new NonTerminal(\"Product\")]),new Rule(\"Sum\",[new NonTerminal(\"Product\")]),new Rule(\"Product\",[new NonTerminal(\"Product\"),new Terminal([\"*\",\"/\"]),new NonTerminal(\"Factor\")]),new Rule(\"Product\",[new NonTerminal(\"Factor\")]),new Rule(\"Factor\",[new Terminal(\"(\"),new NonTerminal(\"Sum\"),new Terminal(\")\")]),new Rule(\"Factor\",[new NonTerminal(\"Number\")]),new Rule(\"Number\",[new NonTerminal(\"Number\"),new Terminal([\"0\",\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\"])]),new Rule(\"Number\",[new Terminal([\"0\",\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\",\"9\"])])]);export var testAactionsA=[function(lOperand,op,rOperand){return[lOperand,op,rOperand];},function(product){return product;},function(lOperand,op,rOperand){return[lOperand,op,rOperand];},function(factor){return factor;},function(lParen,sum,rParen){return sum;},function(number){return number;},function(num1,num2){return num1+num2;},function(number){return number;}];export var testAactionsB=[function(lOperand,op,rOperand){return eval(lOperand+op+rOperand);},function(product){return product;},function(lOperand,op,rOperand){return eval(lOperand+op+rOperand);},function(factor){return factor;},function(lParen,sum,rParen){return sum;},function(number){return number;},function(num1,num2){return num1+num2;},function(number){return number;}];var EarleyRecognizer={buildItems:function buildItems(input,grammar){var nullableSet=this.getNullableRules(grammar);var s=[[]];for(var i=0;i<grammar.rules.length;i++){if(grammar.rules[i].name===grammar.startRule){s[0].push(new EarleyItem(i,0,0));}}for(var _i=0;_i<s.length;_i++){for(var j=0;j<s[_i].length;j++){var symbol=this.nextSymbol(s[_i][j],grammar);if(symbol===null)this.complete(s,_i,j,grammar);else if(symbol instanceof Terminal)this.scan(s,_i,j,symbol,input);else if(symbol instanceof NonTerminal)this.predict(s,_i,j,symbol,nullableSet,grammar);else throw new Error(\"illegal rule\");}}return s;},nextSymbol:function nextSymbol(item,grammar){if(grammar.rules[item.rule].definition.length<=item.next)return null;return grammar.rules[item.rule].definition[item.next];},complete:function complete(s,i,j,grammar){var item=s[i][j];for(var k=0;k<s[item.start].length;k++){var nextSym=this.nextSymbol(s[item.start][k],grammar);if(nextSym!==null&&nextSym.match(grammar.rules[item.rule].name))this.appendItem(s[i],new EarleyItem(s[item.start][k].rule,s[item.start][k].next+1,s[item.start][k].start));}},scan:function scan(s,i,j,symbol,input){if(i>=input.length)return;var item=s[i][j];if(symbol.match(input.substring(i,i+1))){if(i+1>s.length-1)s.push([]);s[i+1].push(new EarleyItem(item.rule,item.next+1,item.start));}},predict:function predict(s,i,j,symbol,nss,grammar){for(var k=0;k<grammar.rules.length;k++){if(symbol.match(grammar.rules[k].name)){this.appendItem(s[i],new EarleyItem(k,0,i));// magical completion\nif(nss.has(grammar.rules[k].name))this.appendItem(s[i],new EarleyItem(s[i][j].rule,s[i][j].next+1,s[i][j].start));}}},appendItem:function appendItem(items,item){var _iterator=_createForOfIteratorHelper(items),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var it=_step.value;if(JSON.stringify(it)===JSON.stringify(item))return false;}}catch(err){_iterator.e(err);}finally{_iterator.f();}items.push(item);return true;},getNullableRules:function getNullableRules(grammar){var nullableSet=new Set();var oldSize=0;do{oldSize=nullableSet.size;this.updateNullableSet(nullableSet,grammar);}while(oldSize!==nullableSet.size);return nullableSet;},updateNullableSet:function updateNullableSet(nullableSet,grammar){for(var i=0;i<grammar.rules.length;i++){if(this.isNullable(grammar.rules[i],nullableSet))nullableSet.add(grammar.rules[i].name);}},isNullable:function isNullable(rule,nullableSet){for(var i=0;i<rule.definition.length;i++){if(nullableSet.has(rule.definition[i].toString())===false)return false;}return true;},printEarlySets:function printEarlySets(s,g){var hideIncomplete=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var lines=[];var maxDefLen=0;var maxNameLen=0;for(var i=0;i<s.length;i++){lines.push([]);for(var j=0;j<s[i].length;j++){var item=s[i][j];var ruleDef=\"\";var ruleName=\"\";if(item.rule>-1){var rule=g.rules[item.rule];ruleName=rule.name;if(ruleName.length>maxNameLen)maxNameLen=ruleName.length;var defSize=rule.definition.length;for(var k=0;k<defSize;k++){if(k===item.next)ruleDef+=\" @\";if(rule.definition[k]instanceof Terminal)ruleDef+=\" \"+rule.definition[k].toString();else if(rule.definition[k]instanceof NonTerminal)ruleDef+=\" \"+rule.definition[k].toString();else throw new Error(\"impossible symbol\");}if(item.next>=defSize)ruleDef+=\" @\";else if(hideIncomplete)continue;if(ruleDef.length>maxDefLen)maxDefLen=ruleDef.length;}else ruleDef=\"{\"+item.rule+\", \"+item.next+\"}\";lines[i].push({name:ruleName,definition:ruleDef,start:\"(\"+item.start+\")\"});}}for(var _i2=0;_i2<lines.length;_i2++){console.log(\"    === \"+_i2+\" ===\");for(var _j=0;_j<lines[_i2].length;_j++){var l=lines[_i2][_j];var str=l.name.padEnd(maxNameLen,\" \")+\" -> \";str+=l.definition.padEnd(maxDefLen)+\" \"+l.start;console.log(str);}if(_i2!==lines.length-1)console.log(\" \");}}};export default EarleyRecognizer;","map":{"version":3,"sources":["C:/Users/Andrew/Documents/JavaScript Projects/bool-simp/src/scripts/Earley Parser/EarleyRecognizer.js"],"names":["StructFactory","Terminal","NonTerminal","EarleyItem","Grammar","Rule","testG2","testG","testAactionsA","lOperand","op","rOperand","product","factor","lParen","sum","rParen","number","num1","num2","testAactionsB","eval","EarleyRecognizer","buildItems","input","grammar","nullableSet","getNullableRules","s","i","rules","length","name","startRule","push","j","symbol","nextSymbol","complete","scan","predict","Error","item","rule","definition","next","k","start","nextSym","match","appendItem","substring","nss","has","items","it","JSON","stringify","Set","oldSize","size","updateNullableSet","isNullable","add","toString","printEarlySets","g","hideIncomplete","lines","maxDefLen","maxNameLen","ruleDef","ruleName","defSize","console","log","l","str","padEnd"],"mappings":"sMAAA,4BAEA,MAAOA,CAAAA,aAAP,KAA0B,kBAA1B,CACA,OAASC,QAAT,CAAmBC,WAAnB,KAAsC,UAAtC,CAEA,MAAO,IAAMC,CAAAA,UAAU,CAAGH,aAAa,CAAC,iBAAD,CAAhC,CACP,MAAO,IAAMI,CAAAA,OAAO,CAAGJ,aAAa,CAAC,iBAAD,CAA7B,CACP,MAAO,IAAMK,CAAAA,IAAI,CAAGL,aAAa,CAAC,iBAAD,CAA1B,CAEP,MAAO,IAAMM,CAAAA,MAAM,CAAG,GAAIF,CAAAA,OAAJ,CAAY,GAAZ,CAAiB,CACnC,GAAIC,CAAAA,IAAJ,CAAS,GAAT,CAAc,CAAC,GAAIH,CAAAA,WAAJ,CAAgB,GAAhB,CAAD,CAAuB,GAAID,CAAAA,QAAJ,CAAa,GAAb,CAAvB,CAAd,CADmC,CAEnC,GAAII,CAAAA,IAAJ,CAAS,GAAT,CAAc,EAAd,CAFmC,CAAjB,CAAf,CAKP,MAAO,IAAME,CAAAA,KAAK,CAAG,GAAIH,CAAAA,OAAJ,CAAY,KAAZ,CAAmB,CACpC,GAAIC,CAAAA,IAAJ,CAAS,KAAT,CAAgB,CACZ,GAAIH,CAAAA,WAAJ,CAAgB,KAAhB,CADY,CAEZ,GAAID,CAAAA,QAAJ,CAAa,CAAC,GAAD,CAAM,GAAN,CAAb,CAFY,CAGZ,GAAIC,CAAAA,WAAJ,CAAgB,SAAhB,CAHY,CAAhB,CADoC,CAOpC,GAAIG,CAAAA,IAAJ,CAAS,KAAT,CAAgB,CAAC,GAAIH,CAAAA,WAAJ,CAAgB,SAAhB,CAAD,CAAhB,CAPoC,CASpC,GAAIG,CAAAA,IAAJ,CAAS,SAAT,CAAoB,CAChB,GAAIH,CAAAA,WAAJ,CAAgB,SAAhB,CADgB,CAEhB,GAAID,CAAAA,QAAJ,CAAa,CAAC,GAAD,CAAM,GAAN,CAAb,CAFgB,CAGhB,GAAIC,CAAAA,WAAJ,CAAgB,QAAhB,CAHgB,CAApB,CAToC,CAepC,GAAIG,CAAAA,IAAJ,CAAS,SAAT,CAAoB,CAAC,GAAIH,CAAAA,WAAJ,CAAgB,QAAhB,CAAD,CAApB,CAfoC,CAiBpC,GAAIG,CAAAA,IAAJ,CAAS,QAAT,CAAmB,CAAC,GAAIJ,CAAAA,QAAJ,CAAa,GAAb,CAAD,CAAoB,GAAIC,CAAAA,WAAJ,CAAgB,KAAhB,CAApB,CAA4C,GAAID,CAAAA,QAAJ,CAAa,GAAb,CAA5C,CAAnB,CAjBoC,CAmBpC,GAAII,CAAAA,IAAJ,CAAS,QAAT,CAAmB,CAAC,GAAIH,CAAAA,WAAJ,CAAgB,QAAhB,CAAD,CAAnB,CAnBoC,CAoBpC,GAAIG,CAAAA,IAAJ,CAAS,QAAT,CAAmB,CACf,GAAIH,CAAAA,WAAJ,CAAgB,QAAhB,CADe,CAEf,GAAID,CAAAA,QAAJ,CAAa,CAAC,GAAD,CAAM,GAAN,CAAW,GAAX,CAAgB,GAAhB,CAAqB,GAArB,CAA0B,GAA1B,CAA+B,GAA/B,CAAoC,GAApC,CAAyC,GAAzC,CAA8C,GAA9C,CAAb,CAFe,CAAnB,CApBoC,CAyBpC,GAAII,CAAAA,IAAJ,CAAS,QAAT,CAAmB,CACf,GAAIJ,CAAAA,QAAJ,CAAa,CAAC,GAAD,CAAM,GAAN,CAAW,GAAX,CAAgB,GAAhB,CAAqB,GAArB,CAA0B,GAA1B,CAA+B,GAA/B,CAAoC,GAApC,CAAyC,GAAzC,CAA8C,GAA9C,CAAb,CADe,CAAnB,CAzBoC,CAAnB,CAAd,CA8BP,MAAO,IAAMO,CAAAA,aAAa,CAAG,CACzB,SAACC,QAAD,CAAWC,EAAX,CAAeC,QAAf,QAA4B,CAACF,QAAD,CAAWC,EAAX,CAAeC,QAAf,CAA5B,EADyB,CAEzB,SAACC,OAAD,QAAaA,CAAAA,OAAb,EAFyB,CAGzB,SAACH,QAAD,CAAWC,EAAX,CAAeC,QAAf,QAA4B,CAACF,QAAD,CAAWC,EAAX,CAAeC,QAAf,CAA5B,EAHyB,CAIzB,SAACE,MAAD,QAAYA,CAAAA,MAAZ,EAJyB,CAKzB,SAACC,MAAD,CAASC,GAAT,CAAcC,MAAd,QAAyBD,CAAAA,GAAzB,EALyB,CAMzB,SAACE,MAAD,QAAYA,CAAAA,MAAZ,EANyB,CAOzB,SAACC,IAAD,CAAOC,IAAP,QAAgBD,CAAAA,IAAI,CAAGC,IAAvB,EAPyB,CAQzB,SAACF,MAAD,QAAYA,CAAAA,MAAZ,EARyB,CAAtB,CAWP,MAAO,IAAMG,CAAAA,aAAa,CAAG,CACzB,SAACX,QAAD,CAAWC,EAAX,CAAeC,QAAf,QAA4BU,CAAAA,IAAI,CAACZ,QAAQ,CAAGC,EAAX,CAAgBC,QAAjB,CAAhC,EADyB,CAEzB,SAACC,OAAD,QAAaA,CAAAA,OAAb,EAFyB,CAGzB,SAACH,QAAD,CAAWC,EAAX,CAAeC,QAAf,QAA4BU,CAAAA,IAAI,CAACZ,QAAQ,CAAGC,EAAX,CAAgBC,QAAjB,CAAhC,EAHyB,CAIzB,SAACE,MAAD,QAAYA,CAAAA,MAAZ,EAJyB,CAKzB,SAACC,MAAD,CAASC,GAAT,CAAcC,MAAd,QAAyBD,CAAAA,GAAzB,EALyB,CAMzB,SAACE,MAAD,QAAYA,CAAAA,MAAZ,EANyB,CAOzB,SAACC,IAAD,CAAOC,IAAP,QAAgBD,CAAAA,IAAI,CAAGC,IAAvB,EAPyB,CAQzB,SAACF,MAAD,QAAYA,CAAAA,MAAZ,EARyB,CAAtB,CAWP,GAAMK,CAAAA,gBAAgB,CAAG,CACrBC,UADqB,qBACVC,KADU,CACHC,OADG,CACM,CACvB,GAAIC,CAAAA,WAAW,CAAG,KAAKC,gBAAL,CAAsBF,OAAtB,CAAlB,CACA,GAAIG,CAAAA,CAAC,CAAG,CAAC,EAAD,CAAR,CAEA,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGJ,OAAO,CAACK,KAAR,CAAcC,MAAlC,CAA0CF,CAAC,EAA3C,CAA+C,CAC3C,GAAIJ,OAAO,CAACK,KAAR,CAAcD,CAAd,EAAiBG,IAAjB,GAA0BP,OAAO,CAACQ,SAAtC,CAAiD,CAC7CL,CAAC,CAAC,CAAD,CAAD,CAAKM,IAAL,CAAU,GAAI/B,CAAAA,UAAJ,CAAe0B,CAAf,CAAkB,CAAlB,CAAqB,CAArB,CAAV,EACH,CACJ,CAED,IAAK,GAAIA,CAAAA,EAAC,CAAG,CAAb,CAAgBA,EAAC,CAAGD,CAAC,CAACG,MAAtB,CAA8BF,EAAC,EAA/B,CAAmC,CAC/B,IAAK,GAAIM,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGP,CAAC,CAACC,EAAD,CAAD,CAAKE,MAAzB,CAAiCI,CAAC,EAAlC,CAAsC,CAClC,GAAIC,CAAAA,MAAM,CAAG,KAAKC,UAAL,CAAgBT,CAAC,CAACC,EAAD,CAAD,CAAKM,CAAL,CAAhB,CAAyBV,OAAzB,CAAb,CACA,GAAIW,MAAM,GAAK,IAAf,CAAqB,KAAKE,QAAL,CAAcV,CAAd,CAAiBC,EAAjB,CAAoBM,CAApB,CAAuBV,OAAvB,EAArB,IACK,IAAIW,MAAM,WAAYnC,CAAAA,QAAtB,CAAgC,KAAKsC,IAAL,CAAUX,CAAV,CAAaC,EAAb,CAAgBM,CAAhB,CAAmBC,MAAnB,CAA2BZ,KAA3B,EAAhC,IACA,IAAIY,MAAM,WAAYlC,CAAAA,WAAtB,CACD,KAAKsC,OAAL,CAAaZ,CAAb,CAAgBC,EAAhB,CAAmBM,CAAnB,CAAsBC,MAAtB,CAA8BV,WAA9B,CAA2CD,OAA3C,EADC,IAEA,MAAM,IAAIgB,CAAAA,KAAJ,CAAU,cAAV,CAAN,CACR,CACJ,CAED,MAAOb,CAAAA,CAAP,CACH,CAvBoB,CAyBrBS,UAzBqB,qBAyBVK,IAzBU,CAyBJjB,OAzBI,CAyBK,CACtB,GAAIA,OAAO,CAACK,KAAR,CAAcY,IAAI,CAACC,IAAnB,EAAyBC,UAAzB,CAAoCb,MAApC,EAA8CW,IAAI,CAACG,IAAvD,CAA6D,MAAO,KAAP,CAC7D,MAAOpB,CAAAA,OAAO,CAACK,KAAR,CAAcY,IAAI,CAACC,IAAnB,EAAyBC,UAAzB,CAAoCF,IAAI,CAACG,IAAzC,CAAP,CACH,CA5BoB,CA8BrBP,QA9BqB,mBA8BZV,CA9BY,CA8BTC,CA9BS,CA8BNM,CA9BM,CA8BHV,OA9BG,CA8BM,CACvB,GAAIiB,CAAAA,IAAI,CAAGd,CAAC,CAACC,CAAD,CAAD,CAAKM,CAAL,CAAX,CACA,IAAK,GAAIW,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGlB,CAAC,CAACc,IAAI,CAACK,KAAN,CAAD,CAAchB,MAAlC,CAA0Ce,CAAC,EAA3C,CAA+C,CAC3C,GAAIE,CAAAA,OAAO,CAAG,KAAKX,UAAL,CAAgBT,CAAC,CAACc,IAAI,CAACK,KAAN,CAAD,CAAcD,CAAd,CAAhB,CAAkCrB,OAAlC,CAAd,CACA,GAAIuB,OAAO,GAAK,IAAZ,EAAoBA,OAAO,CAACC,KAAR,CAAcxB,OAAO,CAACK,KAAR,CAAcY,IAAI,CAACC,IAAnB,EAAyBX,IAAvC,CAAxB,CACI,KAAKkB,UAAL,CACItB,CAAC,CAACC,CAAD,CADL,CAEI,GAAI1B,CAAAA,UAAJ,CACIyB,CAAC,CAACc,IAAI,CAACK,KAAN,CAAD,CAAcD,CAAd,EAAiBH,IADrB,CAEIf,CAAC,CAACc,IAAI,CAACK,KAAN,CAAD,CAAcD,CAAd,EAAiBD,IAAjB,CAAwB,CAF5B,CAGIjB,CAAC,CAACc,IAAI,CAACK,KAAN,CAAD,CAAcD,CAAd,EAAiBC,KAHrB,CAFJ,EAQP,CACJ,CA5CoB,CA8CrBR,IA9CqB,eA8ChBX,CA9CgB,CA8CbC,CA9Ca,CA8CVM,CA9CU,CA8CPC,MA9CO,CA8CCZ,KA9CD,CA8CQ,CACzB,GAAIK,CAAC,EAAIL,KAAK,CAACO,MAAf,CAAuB,OAEvB,GAAIW,CAAAA,IAAI,CAAGd,CAAC,CAACC,CAAD,CAAD,CAAKM,CAAL,CAAX,CACA,GAAIC,MAAM,CAACa,KAAP,CAAazB,KAAK,CAAC2B,SAAN,CAAgBtB,CAAhB,CAAmBA,CAAC,CAAG,CAAvB,CAAb,CAAJ,CAA6C,CACzC,GAAIA,CAAC,CAAG,CAAJ,CAAQD,CAAC,CAACG,MAAF,CAAW,CAAvB,CAA0BH,CAAC,CAACM,IAAF,CAAO,EAAP,EAE1BN,CAAC,CAACC,CAAC,CAAG,CAAL,CAAD,CAASK,IAAT,CAAc,GAAI/B,CAAAA,UAAJ,CAAeuC,IAAI,CAACC,IAApB,CAA0BD,IAAI,CAACG,IAAL,CAAY,CAAtC,CAAyCH,IAAI,CAACK,KAA9C,CAAd,EACH,CACJ,CAvDoB,CAyDrBP,OAzDqB,kBAyDbZ,CAzDa,CAyDVC,CAzDU,CAyDPM,CAzDO,CAyDJC,MAzDI,CAyDIgB,GAzDJ,CAyDS3B,OAzDT,CAyDkB,CACnC,IAAK,GAAIqB,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGrB,OAAO,CAACK,KAAR,CAAcC,MAAlC,CAA0Ce,CAAC,EAA3C,CAA+C,CAC3C,GAAIV,MAAM,CAACa,KAAP,CAAaxB,OAAO,CAACK,KAAR,CAAcgB,CAAd,EAAiBd,IAA9B,CAAJ,CAAyC,CACrC,KAAKkB,UAAL,CAAgBtB,CAAC,CAACC,CAAD,CAAjB,CAAsB,GAAI1B,CAAAA,UAAJ,CAAe2C,CAAf,CAAkB,CAAlB,CAAqBjB,CAArB,CAAtB,EACA;AACA,GAAIuB,GAAG,CAACC,GAAJ,CAAQ5B,OAAO,CAACK,KAAR,CAAcgB,CAAd,EAAiBd,IAAzB,CAAJ,CACI,KAAKkB,UAAL,CACItB,CAAC,CAACC,CAAD,CADL,CAEI,GAAI1B,CAAAA,UAAJ,CAAeyB,CAAC,CAACC,CAAD,CAAD,CAAKM,CAAL,EAAQQ,IAAvB,CAA6Bf,CAAC,CAACC,CAAD,CAAD,CAAKM,CAAL,EAAQU,IAAR,CAAe,CAA5C,CAA+CjB,CAAC,CAACC,CAAD,CAAD,CAAKM,CAAL,EAAQY,KAAvD,CAFJ,EAIP,CACJ,CACJ,CArEoB,CAuErBG,UAvEqB,qBAuEVI,KAvEU,CAuEHZ,IAvEG,CAuEG,0CACHY,KADG,YACpB,+CAAwB,IAAbC,CAAAA,EAAa,aACpB,GAAIC,IAAI,CAACC,SAAL,CAAeF,EAAf,IAAuBC,IAAI,CAACC,SAAL,CAAef,IAAf,CAA3B,CAAiD,MAAO,MAAP,CACpD,CAHmB,qDAIpBY,KAAK,CAACpB,IAAN,CAAWQ,IAAX,EACA,MAAO,KAAP,CACH,CA7EoB,CA+ErBf,gBA/EqB,2BA+EJF,OA/EI,CA+EK,CACtB,GAAIC,CAAAA,WAAW,CAAG,GAAIgC,CAAAA,GAAJ,EAAlB,CACA,GAAIC,CAAAA,OAAO,CAAG,CAAd,CACA,EAAG,CACCA,OAAO,CAAGjC,WAAW,CAACkC,IAAtB,CACA,KAAKC,iBAAL,CAAuBnC,WAAvB,CAAoCD,OAApC,EACH,CAHD,MAGSkC,OAAO,GAAKjC,WAAW,CAACkC,IAHjC,EAIA,MAAOlC,CAAAA,WAAP,CACH,CAvFoB,CAyFrBmC,iBAzFqB,4BAyFHnC,WAzFG,CAyFUD,OAzFV,CAyFmB,CACpC,IAAK,GAAII,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGJ,OAAO,CAACK,KAAR,CAAcC,MAAlC,CAA0CF,CAAC,EAA3C,CAA+C,CAC3C,GAAI,KAAKiC,UAAL,CAAgBrC,OAAO,CAACK,KAAR,CAAcD,CAAd,CAAhB,CAAkCH,WAAlC,CAAJ,CACIA,WAAW,CAACqC,GAAZ,CAAgBtC,OAAO,CAACK,KAAR,CAAcD,CAAd,EAAiBG,IAAjC,EACP,CACJ,CA9FoB,CAgGrB8B,UAhGqB,qBAgGVnB,IAhGU,CAgGJjB,WAhGI,CAgGS,CAC1B,IAAK,GAAIG,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGc,IAAI,CAACC,UAAL,CAAgBb,MAApC,CAA4CF,CAAC,EAA7C,CAAiD,CAC7C,GAAIH,WAAW,CAAC2B,GAAZ,CAAgBV,IAAI,CAACC,UAAL,CAAgBf,CAAhB,EAAmBmC,QAAnB,EAAhB,IAAmD,KAAvD,CAA8D,MAAO,MAAP,CACjE,CACD,MAAO,KAAP,CACH,CArGoB,CAuGrBC,cAvGqB,yBAuGNrC,CAvGM,CAuGHsC,CAvGG,CAuGwB,IAAxBC,CAAAA,cAAwB,2DAAP,KAAO,CACzC,GAAIC,CAAAA,KAAK,CAAG,EAAZ,CACA,GAAIC,CAAAA,SAAS,CAAG,CAAhB,CACA,GAAIC,CAAAA,UAAU,CAAG,CAAjB,CAEA,IAAK,GAAIzC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGD,CAAC,CAACG,MAAtB,CAA8BF,CAAC,EAA/B,CAAmC,CAC/BuC,KAAK,CAAClC,IAAN,CAAW,EAAX,EACA,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGP,CAAC,CAACC,CAAD,CAAD,CAAKE,MAAzB,CAAiCI,CAAC,EAAlC,CAAsC,CAClC,GAAIO,CAAAA,IAAI,CAAGd,CAAC,CAACC,CAAD,CAAD,CAAKM,CAAL,CAAX,CACA,GAAIoC,CAAAA,OAAO,CAAG,EAAd,CACA,GAAIC,CAAAA,QAAQ,CAAG,EAAf,CAEA,GAAI9B,IAAI,CAACC,IAAL,CAAY,CAAC,CAAjB,CAAoB,CAChB,GAAIA,CAAAA,IAAI,CAAGuB,CAAC,CAACpC,KAAF,CAAQY,IAAI,CAACC,IAAb,CAAX,CACA6B,QAAQ,CAAG7B,IAAI,CAACX,IAAhB,CACA,GAAIwC,QAAQ,CAACzC,MAAT,CAAkBuC,UAAtB,CAAkCA,UAAU,CAAGE,QAAQ,CAACzC,MAAtB,CAElC,GAAI0C,CAAAA,OAAO,CAAG9B,IAAI,CAACC,UAAL,CAAgBb,MAA9B,CACA,IAAK,GAAIe,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAG2B,OAApB,CAA6B3B,CAAC,EAA9B,CAAkC,CAC9B,GAAIA,CAAC,GAAKJ,IAAI,CAACG,IAAf,CAAqB0B,OAAO,EAAI,IAAX,CACrB,GAAI5B,IAAI,CAACC,UAAL,CAAgBE,CAAhB,WAA8B7C,CAAAA,QAAlC,CACIsE,OAAO,EAAI,IAAM5B,IAAI,CAACC,UAAL,CAAgBE,CAAhB,EAAmBkB,QAAnB,EAAjB,CADJ,IAEK,IAAIrB,IAAI,CAACC,UAAL,CAAgBE,CAAhB,WAA8B5C,CAAAA,WAAlC,CACDqE,OAAO,EAAI,IAAM5B,IAAI,CAACC,UAAL,CAAgBE,CAAhB,EAAmBkB,QAAnB,EAAjB,CADC,IAEA,MAAM,IAAIvB,CAAAA,KAAJ,CAAU,mBAAV,CAAN,CACR,CACD,GAAIC,IAAI,CAACG,IAAL,EAAa4B,OAAjB,CAA0BF,OAAO,EAAI,IAAX,CAA1B,IACK,IAAIJ,cAAJ,CAAoB,SAEzB,GAAII,OAAO,CAACxC,MAAR,CAAiBsC,SAArB,CAAgCA,SAAS,CAAGE,OAAO,CAACxC,MAApB,CACnC,CAlBD,IAkBOwC,CAAAA,OAAO,CAAG,IAAM7B,IAAI,CAACC,IAAX,CAAkB,IAAlB,CAAyBD,IAAI,CAACG,IAA9B,CAAqC,GAA/C,CAEPuB,KAAK,CAACvC,CAAD,CAAL,CAASK,IAAT,CAAc,CACVF,IAAI,CAAEwC,QADI,CAEV5B,UAAU,CAAE2B,OAFF,CAGVxB,KAAK,CAAE,IAAML,IAAI,CAACK,KAAX,CAAmB,GAHhB,CAAd,EAKH,CACJ,CAED,IAAK,GAAIlB,CAAAA,GAAC,CAAG,CAAb,CAAgBA,GAAC,CAAGuC,KAAK,CAACrC,MAA1B,CAAkCF,GAAC,EAAnC,CAAuC,CACnC6C,OAAO,CAACC,GAAR,CAAY,WAAa9C,GAAb,CAAiB,MAA7B,EACA,IAAK,GAAIM,CAAAA,EAAC,CAAG,CAAb,CAAgBA,EAAC,CAAGiC,KAAK,CAACvC,GAAD,CAAL,CAASE,MAA7B,CAAqCI,EAAC,EAAtC,CAA0C,CACtC,GAAIyC,CAAAA,CAAC,CAAGR,KAAK,CAACvC,GAAD,CAAL,CAASM,EAAT,CAAR,CACA,GAAI0C,CAAAA,GAAG,CAAGD,CAAC,CAAC5C,IAAF,CAAO8C,MAAP,CAAcR,UAAd,CAA0B,GAA1B,EAAiC,MAA3C,CACAO,GAAG,EAAID,CAAC,CAAChC,UAAF,CAAakC,MAAb,CAAoBT,SAApB,EAAiC,GAAjC,CAAuCO,CAAC,CAAC7B,KAAhD,CACA2B,OAAO,CAACC,GAAR,CAAYE,GAAZ,EACH,CACD,GAAIhD,GAAC,GAAKuC,KAAK,CAACrC,MAAN,CAAe,CAAzB,CAA4B2C,OAAO,CAACC,GAAR,CAAY,GAAZ,EAC/B,CACJ,CAzJoB,CAAzB,CA4JA,cAAerD,CAAAA,gBAAf","sourcesContent":["/* eslint-disable no-eval */\r\n\r\nimport StructFactory from \"../StructFactory\";\r\nimport { Terminal, NonTerminal } from \"./Symbol\";\r\n\r\nexport const EarleyItem = StructFactory(\"rule next start\");\r\nexport const Grammar = StructFactory(\"startRule rules\");\r\nexport const Rule = StructFactory(\"name definition\");\r\n\r\nexport const testG2 = new Grammar(\"A\", [\r\n    new Rule(\"A\", [new NonTerminal(\"A\"), new Terminal(\"a\")]),\r\n    new Rule(\"A\", []),\r\n]);\r\n\r\nexport const testG = new Grammar(\"Sum\", [\r\n    new Rule(\"Sum\", [\r\n        new NonTerminal(\"Sum\"),\r\n        new Terminal([\"+\", \"-\"]),\r\n        new NonTerminal(\"Product\"),\r\n    ]),\r\n\r\n    new Rule(\"Sum\", [new NonTerminal(\"Product\")]),\r\n\r\n    new Rule(\"Product\", [\r\n        new NonTerminal(\"Product\"),\r\n        new Terminal([\"*\", \"/\"]),\r\n        new NonTerminal(\"Factor\"),\r\n    ]),\r\n\r\n    new Rule(\"Product\", [new NonTerminal(\"Factor\")]),\r\n\r\n    new Rule(\"Factor\", [new Terminal(\"(\"), new NonTerminal(\"Sum\"), new Terminal(\")\")]),\r\n\r\n    new Rule(\"Factor\", [new NonTerminal(\"Number\")]),\r\n    new Rule(\"Number\", [\r\n        new NonTerminal(\"Number\"),\r\n        new Terminal([\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\"]),\r\n    ]),\r\n\r\n    new Rule(\"Number\", [\r\n        new Terminal([\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\"]),\r\n    ]),\r\n]);\r\n\r\nexport const testAactionsA = [\r\n    (lOperand, op, rOperand) => [lOperand, op, rOperand],\r\n    (product) => product,\r\n    (lOperand, op, rOperand) => [lOperand, op, rOperand],\r\n    (factor) => factor,\r\n    (lParen, sum, rParen) => sum,\r\n    (number) => number,\r\n    (num1, num2) => num1 + num2,\r\n    (number) => number,\r\n];\r\n\r\nexport const testAactionsB = [\r\n    (lOperand, op, rOperand) => eval(lOperand + op + rOperand),\r\n    (product) => product,\r\n    (lOperand, op, rOperand) => eval(lOperand + op + rOperand),\r\n    (factor) => factor,\r\n    (lParen, sum, rParen) => sum,\r\n    (number) => number,\r\n    (num1, num2) => num1 + num2,\r\n    (number) => number,\r\n];\r\n\r\nconst EarleyRecognizer = {\r\n    buildItems(input, grammar) {\r\n        let nullableSet = this.getNullableRules(grammar);\r\n        let s = [[]];\r\n\r\n        for (let i = 0; i < grammar.rules.length; i++) {\r\n            if (grammar.rules[i].name === grammar.startRule) {\r\n                s[0].push(new EarleyItem(i, 0, 0));\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < s.length; i++) {\r\n            for (let j = 0; j < s[i].length; j++) {\r\n                let symbol = this.nextSymbol(s[i][j], grammar);\r\n                if (symbol === null) this.complete(s, i, j, grammar);\r\n                else if (symbol instanceof Terminal) this.scan(s, i, j, symbol, input);\r\n                else if (symbol instanceof NonTerminal)\r\n                    this.predict(s, i, j, symbol, nullableSet, grammar);\r\n                else throw new Error(\"illegal rule\");\r\n            }\r\n        }\r\n\r\n        return s;\r\n    },\r\n\r\n    nextSymbol(item, grammar) {\r\n        if (grammar.rules[item.rule].definition.length <= item.next) return null;\r\n        return grammar.rules[item.rule].definition[item.next];\r\n    },\r\n\r\n    complete(s, i, j, grammar) {\r\n        let item = s[i][j];\r\n        for (let k = 0; k < s[item.start].length; k++) {\r\n            let nextSym = this.nextSymbol(s[item.start][k], grammar);\r\n            if (nextSym !== null && nextSym.match(grammar.rules[item.rule].name))\r\n                this.appendItem(\r\n                    s[i],\r\n                    new EarleyItem(\r\n                        s[item.start][k].rule,\r\n                        s[item.start][k].next + 1,\r\n                        s[item.start][k].start\r\n                    )\r\n                );\r\n        }\r\n    },\r\n\r\n    scan(s, i, j, symbol, input) {\r\n        if (i >= input.length) return;\r\n\r\n        let item = s[i][j];\r\n        if (symbol.match(input.substring(i, i + 1))) {\r\n            if (i + 1 > s.length - 1) s.push([]);\r\n\r\n            s[i + 1].push(new EarleyItem(item.rule, item.next + 1, item.start));\r\n        }\r\n    },\r\n\r\n    predict(s, i, j, symbol, nss, grammar) {\r\n        for (let k = 0; k < grammar.rules.length; k++) {\r\n            if (symbol.match(grammar.rules[k].name)) {\r\n                this.appendItem(s[i], new EarleyItem(k, 0, i));\r\n                // magical completion\r\n                if (nss.has(grammar.rules[k].name))\r\n                    this.appendItem(\r\n                        s[i],\r\n                        new EarleyItem(s[i][j].rule, s[i][j].next + 1, s[i][j].start)\r\n                    );\r\n            }\r\n        }\r\n    },\r\n\r\n    appendItem(items, item) {\r\n        for (const it of items) {\r\n            if (JSON.stringify(it) === JSON.stringify(item)) return false;\r\n        }\r\n        items.push(item);\r\n        return true;\r\n    },\r\n\r\n    getNullableRules(grammar) {\r\n        let nullableSet = new Set();\r\n        let oldSize = 0;\r\n        do {\r\n            oldSize = nullableSet.size;\r\n            this.updateNullableSet(nullableSet, grammar);\r\n        } while (oldSize !== nullableSet.size);\r\n        return nullableSet;\r\n    },\r\n\r\n    updateNullableSet(nullableSet, grammar) {\r\n        for (let i = 0; i < grammar.rules.length; i++) {\r\n            if (this.isNullable(grammar.rules[i], nullableSet))\r\n                nullableSet.add(grammar.rules[i].name);\r\n        }\r\n    },\r\n\r\n    isNullable(rule, nullableSet) {\r\n        for (let i = 0; i < rule.definition.length; i++) {\r\n            if (nullableSet.has(rule.definition[i].toString()) === false) return false;\r\n        }\r\n        return true;\r\n    },\r\n\r\n    printEarlySets(s, g, hideIncomplete = false) {\r\n        let lines = [];\r\n        let maxDefLen = 0;\r\n        let maxNameLen = 0;\r\n\r\n        for (let i = 0; i < s.length; i++) {\r\n            lines.push([]);\r\n            for (let j = 0; j < s[i].length; j++) {\r\n                let item = s[i][j];\r\n                let ruleDef = \"\";\r\n                let ruleName = \"\";\r\n\r\n                if (item.rule > -1) {\r\n                    let rule = g.rules[item.rule];\r\n                    ruleName = rule.name;\r\n                    if (ruleName.length > maxNameLen) maxNameLen = ruleName.length;\r\n\r\n                    let defSize = rule.definition.length;\r\n                    for (let k = 0; k < defSize; k++) {\r\n                        if (k === item.next) ruleDef += \" @\";\r\n                        if (rule.definition[k] instanceof Terminal)\r\n                            ruleDef += \" \" + rule.definition[k].toString();\r\n                        else if (rule.definition[k] instanceof NonTerminal)\r\n                            ruleDef += \" \" + rule.definition[k].toString();\r\n                        else throw new Error(\"impossible symbol\");\r\n                    }\r\n                    if (item.next >= defSize) ruleDef += \" @\";\r\n                    else if (hideIncomplete) continue;\r\n\r\n                    if (ruleDef.length > maxDefLen) maxDefLen = ruleDef.length;\r\n                } else ruleDef = \"{\" + item.rule + \", \" + item.next + \"}\";\r\n\r\n                lines[i].push({\r\n                    name: ruleName,\r\n                    definition: ruleDef,\r\n                    start: \"(\" + item.start + \")\",\r\n                });\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < lines.length; i++) {\r\n            console.log(\"    === \" + i + \" ===\");\r\n            for (let j = 0; j < lines[i].length; j++) {\r\n                let l = lines[i][j];\r\n                let str = l.name.padEnd(maxNameLen, \" \") + \" -> \";\r\n                str += l.definition.padEnd(maxDefLen) + \" \" + l.start;\r\n                console.log(str);\r\n            }\r\n            if (i !== lines.length - 1) console.log(\" \");\r\n        }\r\n    },\r\n};\r\n\r\nexport default EarleyRecognizer;\r\n"]},"metadata":{},"sourceType":"module"}